#!/usr/bin/python2
# brename -- Batch file renaming

# TODO: Needs to be more fail-proof

from __future__ import print_function
import os, sys

if len(sys.argv) != 3 or ('-h' in sys.argv or '--help' in sys.argv):
   print('usage: {0} SRCFILE DSTFILE\n' \
      'Renames multiple files based on information contained in text files.\n\n' \
      'SRCFILE is a file containing the current file names, one per line\n' \
      'and DSTFILE, similarly, contains the new file names\n'.format(\
         os.path.basename(sys.argv[0])),
      file=sys.stderr)
   sys.exit(0)

fnin = sys.argv[1]
fnout = sys.argv[2]

fin = open(fnin, 'r')
fout = open(fnout, 'r')

for line in fin:
   f1 = line.rstrip('\n')
   f2 = fout.readline().rstrip('\n')
   if f1 != f2:
      if not os.access(f1, os.F_OK):
         print("doesn't exist:", f1)
      elif os.access(f2, os.F_OK):
         print("file exists:", f2)
      else:
         print(f1, '->', f2)
         os.rename(f1, f2)
